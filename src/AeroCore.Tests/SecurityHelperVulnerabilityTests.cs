using System;
using System.Runtime.InteropServices;
using AeroCore.Shared.Helpers;
using Xunit;

namespace AeroCore.Tests
{
    public class SecurityHelperVulnerabilityTests
    {
        [Fact]
        public void IsValidSerialPortName_RejectsSensitiveFiles_OnLinux()
        {
            if (RuntimeInformation.IsOSPlatform(OSPlatform.Linux))
            {
                // Vulnerability: Currently these return True because they start with /dev/ and have no forbidden chars.
                Assert.False(SecurityHelper.IsValidSerialPortName("/dev/mem"), "Should reject /dev/mem");
                Assert.False(SecurityHelper.IsValidSerialPortName("/dev/sda"), "Should reject /dev/sda");
                Assert.False(SecurityHelper.IsValidSerialPortName("/dev/zero"), "Should reject /dev/zero");
                Assert.False(SecurityHelper.IsValidSerialPortName("/dev/random"), "Should reject /dev/random");
            }
        }

        [Fact]
        public void IsValidSerialPortName_RejectsFilesStartingWithCom_OnWindows()
        {
            if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
            {
                // Vulnerability: Currently these return True because they start with "Com".
                Assert.False(SecurityHelper.IsValidSerialPortName("Common/foo.txt"), "Should reject Common/foo.txt");
                Assert.False(SecurityHelper.IsValidSerialPortName("Command.log"), "Should reject Command.log");
                Assert.False(SecurityHelper.IsValidSerialPortName("COM1.txt"), "Should reject COM1.txt (file)");
            }
        }
    }
}
